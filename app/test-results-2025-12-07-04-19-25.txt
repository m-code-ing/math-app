
> app@0.1.0 test
> react-scripts test StorageService.test.ts QuizService.test.ts --no-coverage

(node:10345) [DEP0040] DeprecationWarning: The `punycode` module is deprecated. Please use a userland alternative instead.
(Use `node --trace-deprecation ...` to show where the warning was created)
PASS src/shared/services/__tests__/StorageService.test.ts
  ● Console

    console.error
      Failed to load from localStorage: SyntaxError: Unexpected token 'i', "invalid-json{" is not valid JSON
          at JSON.parse (<anonymous>)
          at StorageService.load (/Users/mayank/mayank/workspace/projects/math-app/app/src/shared/services/StorageService.ts:38:19)
          at Object.<anonymous> (/Users/mayank/mayank/workspace/projects/math-app/app/src/shared/services/__tests__/StorageService.test.ts:109:30)
          at Promise.then.completed (/Users/mayank/mayank/workspace/projects/math-app/app/node_modules/jest-circus/build/utils.js:391:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/mayank/mayank/workspace/projects/math-app/app/node_modules/jest-circus/build/utils.js:316:10)
          at _callCircusTest (/Users/mayank/mayank/workspace/projects/math-app/app/node_modules/jest-circus/build/run.js:218:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTest (/Users/mayank/mayank/workspace/projects/math-app/app/node_modules/jest-circus/build/run.js:155:3)
          at _runTestsForDescribeBlock (/Users/mayank/mayank/workspace/projects/math-app/app/node_modules/jest-circus/build/run.js:66:9)
          at _runTestsForDescribeBlock (/Users/mayank/mayank/workspace/projects/math-app/app/node_modules/jest-circus/build/run.js:60:9)
          at _runTestsForDescribeBlock (/Users/mayank/mayank/workspace/projects/math-app/app/node_modules/jest-circus/build/run.js:60:9)
          at run (/Users/mayank/mayank/workspace/projects/math-app/app/node_modules/jest-circus/build/run.js:25:3)
          at runAndTransformResultsToJestFormat (/Users/mayank/mayank/workspace/projects/math-app/app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:170:21)
          at jestAdapter (/Users/mayank/mayank/workspace/projects/math-app/app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:82:19)
          at runTestInternal (/Users/mayank/mayank/workspace/projects/math-app/app/node_modules/jest-runner/build/runTest.js:389:16)
          at runTest (/Users/mayank/mayank/workspace/projects/math-app/app/node_modules/jest-runner/build/runTest.js:475:34)
          at Object.worker (/Users/mayank/mayank/workspace/projects/math-app/app/node_modules/jest-runner/build/testWorker.js:133:12)

      38 |       return JSON.parse(serialized) as T;
      39 |     } catch (error) {
    > 40 |       console.error('Failed to load from localStorage:', error);
         |               ^
      41 |       return null;
      42 |     }
      43 |   }

      at StorageService.load (src/shared/services/StorageService.ts:40:15)
      at Object.<anonymous> (src/shared/services/__tests__/StorageService.test.ts:109:30)

    console.error
      Failed to save to localStorage: Error: Mock error
          at Proxy.<anonymous> (/Users/mayank/mayank/workspace/projects/math-app/app/src/shared/services/__tests__/StorageService.test.ts:117:15)
          at /Users/mayank/mayank/workspace/projects/math-app/app/node_modules/jest-mock/build/index.js:449:39
          at Proxy.<anonymous> (/Users/mayank/mayank/workspace/projects/math-app/app/node_modules/jest-mock/build/index.js:457:13)
          at Proxy.setItem (/Users/mayank/mayank/workspace/projects/math-app/app/node_modules/jest-mock/build/index.js:170:19)
          at StorageService.save (/Users/mayank/mayank/workspace/projects/math-app/app/src/shared/services/StorageService.ts:15:20)
          at /Users/mayank/mayank/workspace/projects/math-app/app/src/shared/services/__tests__/StorageService.test.ts:120:28
          at Object.<anonymous> (/Users/mayank/mayank/workspace/projects/math-app/app/node_modules/expect/build/toThrowMatchers.js:83:11)
          at Object.toThrow (/Users/mayank/mayank/workspace/projects/math-app/app/node_modules/expect/build/index.js:382:21)
          at Object.<anonymous> (/Users/mayank/mayank/workspace/projects/math-app/app/src/shared/services/__tests__/StorageService.test.ts:120:51)
          at Promise.then.completed (/Users/mayank/mayank/workspace/projects/math-app/app/node_modules/jest-circus/build/utils.js:391:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/mayank/mayank/workspace/projects/math-app/app/node_modules/jest-circus/build/utils.js:316:10)
          at _callCircusTest (/Users/mayank/mayank/workspace/projects/math-app/app/node_modules/jest-circus/build/run.js:218:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTest (/Users/mayank/mayank/workspace/projects/math-app/app/node_modules/jest-circus/build/run.js:155:3)
          at _runTestsForDescribeBlock (/Users/mayank/mayank/workspace/projects/math-app/app/node_modules/jest-circus/build/run.js:66:9)
          at _runTestsForDescribeBlock (/Users/mayank/mayank/workspace/projects/math-app/app/node_modules/jest-circus/build/run.js:60:9)
          at _runTestsForDescribeBlock (/Users/mayank/mayank/workspace/projects/math-app/app/node_modules/jest-circus/build/run.js:60:9)
          at run (/Users/mayank/mayank/workspace/projects/math-app/app/node_modules/jest-circus/build/run.js:25:3)
          at runAndTransformResultsToJestFormat (/Users/mayank/mayank/workspace/projects/math-app/app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:170:21)
          at jestAdapter (/Users/mayank/mayank/workspace/projects/math-app/app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:82:19)
          at runTestInternal (/Users/mayank/mayank/workspace/projects/math-app/app/node_modules/jest-runner/build/runTest.js:389:16)
          at runTest (/Users/mayank/mayank/workspace/projects/math-app/app/node_modules/jest-runner/build/runTest.js:475:34)
          at Object.worker (/Users/mayank/mayank/workspace/projects/math-app/app/node_modules/jest-runner/build/testWorker.js:133:12)

      19 |         throw new Error('Storage quota exceeded');
      20 |       }
    > 21 |       console.error('Failed to save to localStorage:', error);
         |               ^
      22 |       throw error;
      23 |     }
      24 |   }

      at StorageService.save (src/shared/services/StorageService.ts:21:15)
      at src/shared/services/__tests__/StorageService.test.ts:120:28
      at Object.<anonymous> (node_modules/expect/build/toThrowMatchers.js:83:11)
      at Object.toThrow (node_modules/expect/build/index.js:382:21)
      at Object.<anonymous> (src/shared/services/__tests__/StorageService.test.ts:120:51)

(node:10344) [DEP0040] DeprecationWarning: The `punycode` module is deprecated. Please use a userland alternative instead.
(Use `node --trace-deprecation ...` to show where the warning was created)
FAIL src/shared/services/__tests__/QuizService.test.ts
  ● QuizService › user statistics › returns default stats when none exist

    expect(received).toBe(expected) // Object.is equality

    Expected: 0
    Received: 4

      123 |     it('returns default stats when none exist', () => {
      124 |       const stats = service.getUserStats();
    > 125 |       expect(stats.totalQuizzesCompleted).toBe(0);
          |                                           ^
      126 |       expect(stats.totalQuestionsAnswered).toBe(0);
      127 |       expect(stats.totalCorrectAnswers).toBe(0);
      128 |     });

      at Object.<anonymous> (src/shared/services/__tests__/QuizService.test.ts:125:43)

  ● QuizService › user statistics › updates stats after completing session

    expect(received).toBe(expected) // Object.is equality

    Expected: 1
    Received: 5

      143 |       
      144 |       const stats = service.getUserStats();
    > 145 |       expect(stats.totalQuizzesCompleted).toBe(1);
          |                                           ^
      146 |       expect(stats.totalQuestionsAnswered).toBe(10);
      147 |       expect(stats.totalCorrectAnswers).toBe(8);
      148 |       expect(stats.overallAccuracy).toBe(80);

      at Object.<anonymous> (src/shared/services/__tests__/QuizService.test.ts:145:43)

  ● QuizService › user statistics › updates quiz type specific stats

    expect(received).toBe(expected) // Object.is equality

    Expected: 1
    Received: 6

      164 |       
      165 |       const stats = service.getUserStats();
    > 166 |       expect(stats.quizTypeStats.addition.quizzesCompleted).toBe(1);
          |                                                             ^
      167 |       expect(stats.quizTypeStats.addition.averageScore).toBe(80);
      168 |       expect(stats.quizTypeStats.addition.bestScore).toBe(80);
      169 |     });

      at Object.<anonymous> (src/shared/services/__tests__/QuizService.test.ts:166:61)

  ● QuizService › user statistics › calculates average correctly across multiple sessions

    expect(received).toBe(expected) // Object.is equality

    Expected: 90
    Received: 82.5

      196 |       
      197 |       const stats = service.getUserStats();
    > 198 |       expect(stats.overallAccuracy).toBe(90); // (8+10)/(10+10) * 100
          |                                     ^
      199 |       expect(stats.quizTypeStats.addition.averageScore).toBe(90); // (80+100)/2
      200 |     });
      201 |   });

      at Object.<anonymous> (src/shared/services/__tests__/QuizService.test.ts:198:37)

  ● QuizService › clearAllData › clears all service data

    expect(received).toBe(expected) // Object.is equality

    Expected: 0
    Received: 8

      242 |       
      243 |       expect(service.getSessionHistory()).toEqual([]);
    > 244 |       expect(service.getUserStats().totalQuizzesCompleted).toBe(0);
          |                                                            ^
      245 |       expect(service.getPreferences().soundEnabled).toBe(true); // back to default
      246 |     });
      247 |   });

      at Object.<anonymous> (src/shared/services/__tests__/QuizService.test.ts:244:60)

Test Suites: 1 failed, 1 passed, 2 total
Tests:       5 failed, 27 passed, 32 total
Snapshots:   0 total
Time:        0.716 s, estimated 1 s
Ran all test suites matching /StorageService.test.ts|QuizService.test.ts/i.

